
================================================================================
NEW RUN STARTED AT 2025-06-29 01:55:09
Process ID: 103
================================================================================
01:55:09 │ INFO │ Logging system initialized successfully

================================================================================
NEW RUN STARTED AT 2025-06-29 01:55:09
Process ID: 36
================================================================================
01:55:09 │ INFO │ Logging system initialized successfully
01:55:11 │ INFO │ USDA carb table loaded: 303 distinct food descriptions
01:55:11 │ INFO │ Carb map initialised (303 keys)
01:55:11 │ INFO │ ✅ All sanity checks passed
01:55:11 │ INFO │ 🚀 Starting main with args: Namespace(ground_truth=None, train=True, ingredients=None, mode='both', force=False, sample_frac=1.0)
01:55:11 │ INFO │ System/Container total memory: 31.3 GB
01:55:11 │ INFO │ Safe memory limit (90%): 28.1 GB
01:55:11 │ INFO │ 💾 Available memory for processing: 28.1 GB
01:55:11 │ WARNING │ ⚠️  Limited memory detected. Enabling memory optimizations...
01:55:11 │ INFO │ 🚀 Starting main with args: Namespace(ground_truth=None, train=True, ingredients=None, mode='both', force=False, sample_frac=1.0)
01:55:11 │ INFO │ 🧠 SINGLE training run - sample_frac=1.0
01:55:11 │ INFO │ 🚀 STARTING FULL ML PIPELINE
01:55:11 │ INFO │    Mode: both
01:55:11 │ INFO │    Force recomputation: False
01:55:11 │ INFO │    Sample fraction: 1.0
01:55:11 │ INFO │    Start time: 2025-06-29 01:55:11
01:55:11 │ INFO │    Available CPU cores: 24
01:55:11 │ INFO │    Available memory: 31 GB
01:55:11 │ INFO │ 
📂 STAGE 1: DATA LOADING AND PREPARATION
01:55:11 │ INFO │ 
📂 DATASET LOADING PIPELINE
01:55:11 │ INFO │    Configuration: 2 data sources
01:55:11 │ INFO │    Data directory: /app/data
01:55:11 │ INFO │    📊 Data Sources:
01:55:11 │ INFO │    ├─ allrecipes.parquet: Local
01:55:11 │ INFO │    │  └─ /app/data/allrecipes.parquet
01:55:11 │ INFO │    ├─ ground_truth_sample.csv: Local
01:55:11 │ INFO │    │  └─ /app/data/ground_truth_sample.csv
01:55:11 │ INFO │ 
   🍳 STAGE 1: LOADING RECIPES DATASET
01:55:11 │ INFO │    ├─ Source: /app/data/allrecipes.parquet
01:55:11 │ INFO │       ├─ Local file size: 49.2 MB
01:55:11 │ INFO │ USDA carb table loaded: 303 distinct food descriptions
01:55:11 │ INFO │ Carb map initialised (303 keys)
01:55:11 │ INFO │ ✅ All sanity checks passed
01:55:12 │ INFO │       📊 Recipes Dataset:
01:55:12 │ INFO │       ├─ Shape: (225602, 5)
01:55:12 │ INFO │       ├─ Columns: ['title', 'description', 'instructions', 'ingredients', 'photo_url']
01:55:12 │ INFO │       ├─ Memory usage: 145.4 MB
01:55:12 │ INFO │       └─ Load time: 0.5s

================================================================================
NEW RUN STARTED AT 2025-06-29 01:55:14
Process ID: 160
================================================================================
01:55:14 │ INFO │ Logging system initialized successfully
01:55:15 │ INFO │       📈 Data Quality:
01:55:15 │ INFO │       ├─ Total recipes: 225,602
01:55:15 │ INFO │       ├─ Null ingredients: 0
01:55:15 │ INFO │       ├─ Empty ingredients: 0
01:55:15 │ INFO │       └─ With photos: 225,602 (100.0%)
01:55:15 │ INFO │    ✅ Recipes loaded successfully in 4.0s
01:55:15 │ INFO │       💾 Recipes loaded: 17.5% memory used (4982 MB / 32015 MB)
01:55:15 │ INFO │ 
   🎯 STAGE 2: LOADING GROUND TRUTH DATASET
01:55:15 │ INFO │    ├─ Source: /app/data/ground_truth_sample.csv
01:55:15 │ INFO │       ├─ File size: 79.1 KB
01:55:15 │ INFO │       📊 Ground Truth Dataset:
01:55:15 │ INFO │       ├─ Shape: (100, 7)
01:55:15 │ INFO │       ├─ Columns: ['title', 'description', 'instructions', 'ingredients', 'photo_url', 'vegan', 'keto']
01:55:15 │ INFO │       ├─ Keto columns found: ['keto']
01:55:15 │ INFO │       ├─ Vegan columns found: ['vegan']
01:55:15 │ INFO │       └─ Load time: 0.00s
01:55:15 │ INFO │       ├─ Keto labels: 40/100 (40.0% positive)
01:55:15 │ INFO │       ├─ Vegan labels: 40/100 (40.0% positive)
01:55:15 │ INFO │    ✅ Ground truth loaded successfully in 0.1s
01:55:15 │ INFO │       💾 Ground truth loaded: 17.5% memory used (4998 MB / 32015 MB)
01:55:15 │ INFO │ 
   🥈 STAGE 3: GENERATING SILVER LABELS
01:55:16 │ INFO │ USDA carb table loaded: 303 distinct food descriptions
01:55:16 │ INFO │ Carb map initialised (303 keys)
01:55:16 │ INFO │ ✅ All sanity checks passed
01:56:56 │ INFO │       📊 Silver Labels Generated:
01:56:56 │ INFO │       ├─ Total recipes: 225,602
01:56:56 │ INFO │       ├─ Keto positive: 36,722 (16.3%)
01:56:56 │ INFO │       ├─ Vegan positive: 16,378 (7.3%)
01:56:56 │ INFO │       ├─ With photos: 225,602 (100.0%)
01:56:56 │ INFO │       └─ Generation time: 100.9s
01:56:56 │ INFO │    ✅ Silver labels generated successfully in 101.0s
01:56:56 │ INFO │       💾 Silver labels generated: 17.8% memory used (5098 MB / 32015 MB)
01:56:56 │ INFO │ 
   ✅ STAGE 4: DATA VALIDATION AND CROSS-CHECKS
01:56:57 │ INFO │       💾 Memory Usage by Dataset:
01:56:57 │ INFO │       ├─ Recipes: 145.4 MB
01:56:57 │ INFO │       ├─ Silver: 106.4 MB
01:56:57 │ INFO │       ├─ Ground_truth: 0.1 MB
01:56:57 │ INFO │       └─ Total: 251.9 MB
01:56:57 │ INFO │       📊 Label Distribution Comparison:
01:56:57 │ INFO │       ├─ Keto: Gold=40.0%, Silver=16.3%
01:56:57 │ INFO │       └─ Vegan: Gold=40.0%, Silver=7.3%
01:56:57 │ WARNING │       ⚠️  Large keto distribution difference: 23.7%
01:56:57 │ WARNING │       ⚠️  Large vegan distribution difference: 32.7%
01:56:57 │ INFO │       ✅ Validation Summary:
01:56:57 │ INFO │       ├─ Recipes Loaded: ✅
01:56:57 │ INFO │       ├─ Ground Truth Loaded: ✅
01:56:57 │ INFO │       ├─ Silver Generated: ✅
01:56:57 │ INFO │       ├─ Required Columns Present: ✅
01:56:57 │ INFO │       ├─ Labels Processed: ✅
01:56:57 │ INFO │       ├─ Consistency Issues: 0
01:56:57 │ INFO │    ✅ Data validation completed in 0.4s
01:56:57 │ INFO │       💾 Validation complete: 17.9% memory used (5118 MB / 32015 MB)
01:56:57 │ INFO │ USDA carb table loaded: 303 distinct food descriptions
01:56:57 │ INFO │    ✅ USDA table loaded in 0.1s – 303 rows
01:56:57 │ INFO │ 
🏁 DATASET LOADING COMPLETE
01:56:57 │ INFO │    ├─ Total loading time: 105.8s
01:56:57 │ INFO │    ├─ Datasets loaded: 4 (recipes, ground_truth, silver, usda)
01:56:57 │ INFO │    ├─ Total memory usage: 251.9 MB
01:56:57 │ INFO │    └─ All validations passed: ✅
01:56:57 │ INFO │ 
   📋 Final Dataset Summary:
01:56:57 │ INFO │    ├─ Recipes: 225,602 rows × 5 columns
01:56:57 │ INFO │    ├─ Ground Truth: 100 rows × 10 columns
01:56:57 │ INFO │    ├─ Silver Labels: 225,602 rows × 5 columns
01:56:57 │ INFO │    ├─ USDA Carb Tbl:  303 rows × 2 columns (0.0 MB)
01:56:57 │ INFO │    ├─ Total memory usage: 251.9 MB
01:56:57 │ INFO │    └─ Ready for ML pipeline: ✅
01:56:57 │ INFO │ 
   📊 Dataset Statistics:
01:56:57 │ INFO │    ├─ Silver (All): 225,602 recipes
01:56:57 │ INFO │    ├─ Silver (Text): 225,602 recipes
01:56:57 │ INFO │    ├─ Silver (Images): 72,485 recipes
01:56:57 │ INFO │    ├─ Gold (All): 100 recipes
01:56:57 │ INFO │    └─ Gold (Images): 66 recipes
01:56:57 │ INFO │ 
   ⚖️  Class Balance Analysis:
01:56:57 │ INFO │ 
── Gold set set class counts ─────────────
01:56:57 │ INFO │  keto:     40/100 (40.0%)
01:56:57 │ INFO │ vegan:     40/100 (40.0%)
01:56:57 │ INFO │ 
── Silver (Text) set set class counts ─────────────
01:56:58 │ INFO │  keto:  36722/225602 (16.3%)
01:56:58 │ INFO │ vegan:  16378/225602 ( 7.3%)
01:56:58 │ INFO │ 
── Silver (Image) set set class counts ─────────────
01:56:58 │ INFO │  keto:  28518/72485 (39.3%)
01:56:58 │ INFO │ vegan:  12577/72485 (17.4%)
01:56:58 │ INFO │    ✅ Data loading completed in 106.4s
01:56:58 │ INFO │    📊 Data Loading - Memory: 18.0% used (5151 MB / 32015 MB)
01:56:58 │ INFO │ System/Container total memory: 31.3 GB
01:56:58 │ INFO │ Safe memory limit (100%): 31.3 GB
01:56:58 │ INFO │    🧹 Data Loading: Memory optimization
01:56:58 │ INFO │       ├─ Container/System memory: 31.3 GB total
01:56:58 │ INFO │       ├─ Currently used: 18.0% (5151 MB)
01:56:58 │ INFO │       ✅ Memory usage normal: 18.0%
01:56:58 │ INFO │ 
🔤 STAGE 2: TEXT FEATURE PROCESSING
01:56:58 │ INFO │    ├─ Vectorizer config: {'min_df': 2, 'ngram_range': (1, 3), 'max_features': 50000, 'sublinear_tf': True}
01:56:58 │ INFO │ USDA carb table loaded: 303 distinct food descriptions
01:56:58 │ INFO │    ├─ USDA examples added: 303
01:57:11 │ INFO │    📊 Text Processing Results:
01:57:11 │ INFO │    ├─ Vocabulary size: 50,000
01:57:11 │ INFO │    ├─ Silver features: (225905, 50000)
01:57:11 │ INFO │    ├─ Gold features: (100, 50000)
01:57:11 │ INFO │    ├─ Sparsity: 0.0%
01:57:11 │ INFO │    └─ Memory usage: ~103 MB
01:57:11 │ INFO │    ✅ Text processing completed in 13.4s
01:57:11 │ INFO │    📊 Text Processing - Memory: 18.8% used (5409 MB / 32015 MB)
01:57:11 │ INFO │ System/Container total memory: 31.3 GB
01:57:11 │ INFO │ Safe memory limit (100%): 31.3 GB
01:57:11 │ INFO │    🧹 Text Processing: Memory optimization
01:57:12 │ INFO │       ├─ Container/System memory: 31.3 GB total
01:57:12 │ INFO │       ├─ Currently used: 18.8% (5409 MB)
01:57:12 │ INFO │       ✅ Memory usage normal: 18.8%
01:57:12 │ INFO │ 
🖼️  STAGE 3: IMAGE FEATURE PROCESSING
01:57:12 │ INFO │    ├─ Processing 72,485 sampled silver images
01:57:12 │ INFO │    └─ Processing 66 gold images
01:57:12 │ INFO │ 
🧠 EMBEDDINGS-FIRST IMAGE PIPELINE: silver
01:57:12 │ INFO │    Target directory: dataset/arg_max/images/silver
01:57:12 │ INFO │    Total samples: 72,485
01:57:12 │ INFO │    Force recompute: False
01:57:12 │ INFO │    🔍 Searching for existing embeddings...
01:57:12 │ INFO │    ✅ EMBEDDINGS FOUND: /app/artifacts/embeddings_silver_backup.npy
01:57:12 │ INFO │       ├─ Shape: (72422, 2048)
01:57:12 │ INFO │       ├─ Coverage: 99.9% (72,422/72,485)
01:57:12 │ INFO │       ├─ File size: 565.8 MB
01:57:12 │ INFO │       └─ 🚀 SKIPPING IMAGE DOWNLOADS!
01:57:12 │ INFO │       ├─ Silver download: 72,422/72,485 successful
01:57:12 │ INFO │ 
🧠 EMBEDDINGS-FIRST IMAGE PIPELINE: gold
01:57:12 │ INFO │    Target directory: dataset/arg_max/images/gold
01:57:12 │ INFO │    Total samples: 66
01:57:12 │ INFO │    Force recompute: False
01:57:12 │ INFO │    🔍 Searching for existing embeddings...
01:57:12 │ INFO │    ✅ EMBEDDINGS FOUND: /app/artifacts/embeddings_gold_backup.npy
01:57:12 │ INFO │       ├─ Shape: (66, 2048)
01:57:12 │ INFO │       ├─ Coverage: 100.0% (66/66)
01:57:12 │ INFO │       ├─ File size: 0.5 MB
01:57:12 │ INFO │       └─ 🚀 SKIPPING IMAGE DOWNLOADS!
01:57:12 │ INFO │       ├─ Gold download: 66/66 successful
01:57:12 │ INFO │       ├─ Silver filtered: 72,422 with valid images
01:57:12 │ INFO │       ├─ Gold filtered: 66 with valid images
01:57:12 │ INFO │       ├─ Gold filtered: 66 with valid images
01:57:12 │ INFO │ System/Container total memory: 31.3 GB
01:57:12 │ INFO │ Safe memory limit (90%): 28.1 GB
01:57:12 │ INFO │    💾 Memory-aware batch size: 16 (based on 28.1 GB available)
01:57:12 │ INFO │ 
🧠 IMAGE EMBEDDING EXTRACTION: silver
01:57:12 │ INFO │    Target images: 72,422
01:57:12 │ INFO │    Mode: silver
01:57:12 │ INFO │    Force recomputation: False
01:57:12 │ INFO │    🔧 Device Configuration:
01:57:12 │ INFO │    ├─ Device: cpu
01:57:12 │ INFO │    ├─ CUDA available: False
01:57:14 │ INFO │    ✅ Using cached embeddings from Artifacts backup
01:57:14 │ INFO │       ├─ Silver embeddings: (72422, 2048)
01:57:14 │ INFO │       ├─ Silver DataFrame: 72,422 rows
01:57:14 │ INFO │ System/Container total memory: 31.3 GB
01:57:14 │ INFO │ Safe memory limit (90%): 28.1 GB
01:57:14 │ INFO │    💾 Memory-aware batch size: 16 (based on 28.1 GB available)
01:57:14 │ INFO │ 
🧠 IMAGE EMBEDDING EXTRACTION: gold
01:57:14 │ INFO │    Target images: 66
01:57:14 │ INFO │    Mode: gold
01:57:14 │ INFO │    Force recomputation: False
01:57:14 │ INFO │    🔧 Device Configuration:
01:57:14 │ INFO │    ├─ Device: cpu
01:57:14 │ INFO │    ├─ CUDA available: False
01:57:14 │ INFO │    ✅ Using cached embeddings from Artifacts backup
01:57:14 │ INFO │       ├─ Gold embeddings: (66, 2048)
01:57:14 │ INFO │       ├─ Gold DataFrame: 66 rows
01:57:14 │ INFO │       ├─ Saved gold embeddings to embeddings/img_gold.pkl
01:57:15 │ INFO │       ├─ Saved silver embeddings to embeddings/img_silver.pkl
01:57:15 │ INFO │    🔍 DIMENSION VERIFICATION:
01:57:15 │ INFO │    ├─ Silver embeddings: (72422, 2048)
01:57:15 │ INFO │    ├─ Silver DataFrame: 72,422 rows
01:57:15 │ INFO │    ├─ Gold embeddings: (66, 2048)
01:57:15 │ INFO │    └─ Gold DataFrame: 66 rows
01:57:16 │ INFO │    📊 Image Processing Results:
01:57:16 │ INFO │    ├─ Silver images available: 72,485
01:57:16 │ INFO │    ├─ Silver images downloaded: 72,422
01:57:16 │ INFO │    ├─ Silver valid embeddings: 72,422
01:57:16 │ INFO │    ├─ Gold images available: 66
01:57:16 │ INFO │    ├─ Gold images downloaded: 66
01:57:16 │ INFO │    ├─ Gold valid embeddings: 66
01:57:16 │ INFO │    ├─ Silver embedding size: 565 MB
01:57:16 │ INFO │    └─ Gold embedding size: 0 MB
01:57:16 │ INFO │    ✅ Image processing completed in 4.5s
01:57:16 │ INFO │    📊 Image Processing - Memory: 21.8% used (6366 MB / 32015 MB)
01:57:16 │ INFO │ System/Container total memory: 31.3 GB
01:57:16 │ INFO │ Safe memory limit (100%): 31.3 GB
01:57:16 │ INFO │    🧹 Image Processing: Memory optimization
01:57:17 │ INFO │       ├─ Container/System memory: 31.3 GB total
01:57:17 │ INFO │       ├─ Currently used: 21.8% (6366 MB)
01:57:17 │ INFO │       ├─ Freed: 0.0 MB RAM
01:57:17 │ INFO │       ├─ Objects collected: 44
01:57:17 │ INFO │       ✅ Memory usage normal: 21.8%
01:57:17 │ INFO │ 
🤖 STAGE 4: MODEL TRAINING
01:57:17 │ INFO │    🖼️  Training image-based models...
01:57:17 │ INFO │    📊 Mode='both' detected - using combined text+image features
01:57:21 │ INFO │       ├─ Combined features for image models: (72422, 52048)
01:57:21 │ INFO │       ├─ Samples: 72422 silver, 66 gold
01:57:21 │ INFO │ 🚀 Starting MODE A Training Pipeline
01:57:21 │ INFO │    Domain: image
01:57:21 │ INFO │    SMOTE enabled: False
01:57:21 │ INFO │    Silver set size: 72,422
01:57:21 │ INFO │    Gold set size: 66
01:57:21 │ INFO │    Feature dimensions: (72422, 52048)
01:57:21 │ INFO │ 
📊 Class Distribution Analysis:
01:57:21 │ INFO │     Keto - Silver: 11,786/72,422 (16.3%) | Gold: 34/66 (51.5%)
01:57:21 │ INFO │    Vegan - Silver: 5,224.0/72,422 (7.2%) | Gold: 35/66 (53.0%)
01:57:21 │ INFO │ 
🎯 Processing KETO classification:
01:57:21 │ INFO │    Training labels - Positive: 11,786 (16.3%)
01:57:21 │ INFO │    Test labels - Positive: 34 (51.5%)
01:57:21 │ INFO │    ⏭️  SMOTE disabled, using original data
01:57:21 │ INFO │    🤖 Training 2 models: ['RF', 'LGBM']
01:57:25 │ INFO │       ✅     RF_IMAGE: F1=0.957 | ACC=0.955 | PREC=0.943 | REC=0.971 | Time=4.0s
01:57:25 │ INFO │       🏆 New best model for keto: RF_IMAGE (F1=0.957)

================================================================================
NEW RUN STARTED AT 2025-06-29 01:58:23
Process ID: 286
================================================================================
01:58:24 │ INFO │ Logging system initialized successfully
01:58:26 │ INFO │ USDA carb table loaded: 303 distinct food descriptions
01:58:26 │ INFO │ Carb map initialised (303 keys)
01:58:26 │ INFO │ ✅ All sanity checks passed
01:58:42 │ INFO │       ✅   LGBM_IMAGE: F1=0.957 | ACC=0.955 | PREC=0.943 | REC=0.971 | Time=76.7s
01:58:42 │ INFO │    🎯 KETO COMPLETE:
01:58:42 │ INFO │    ├─ Best Model: RF_IMAGE (F1=0.957)
01:58:42 │ INFO │    ├─ Final Metrics: ACC=0.955 | PREC=0.943 | REC=0.971
01:58:42 │ INFO │    └─ Task Time: 80.9s
01:58:42 │ INFO │ 
🎯 Processing VEGAN classification:
01:58:42 │ INFO │    Training labels - Positive: 5,224 (7.2%)
01:58:42 │ INFO │    Test labels - Positive: 35 (53.0%)
01:58:42 │ INFO │    ⏭️  SMOTE disabled, using original data
01:58:42 │ INFO │    🤖 Training 2 models: ['RF', 'LGBM']
01:58:46 │ INFO │       ✅     RF_IMAGE: F1=0.986 | ACC=0.985 | PREC=0.972 | REC=1.000 | Time=4.3s
01:58:46 │ INFO │       🏆 New best model for vegan: RF_IMAGE (F1=0.986)

================================================================================
NEW RUN STARTED AT 2025-06-29 01:58:48
Process ID: 362
================================================================================
01:58:48 │ INFO │ Logging system initialized successfully
01:58:50 │ INFO │ USDA carb table loaded: 303 distinct food descriptions
01:58:50 │ INFO │ Carb map initialised (303 keys)
01:58:50 │ INFO │ ✅ All sanity checks passed
01:59:39 │ INFO │       ✅   LGBM_IMAGE: F1=0.986 | ACC=0.985 | PREC=0.972 | REC=1.000 | Time=52.1s
01:59:39 │ INFO │    🎯 VEGAN COMPLETE:
01:59:39 │ INFO │    ├─ Best Model: RF_IMAGE (F1=0.986)
01:59:39 │ INFO │    ├─ Final Metrics: ACC=0.985 | PREC=0.972 | REC=1.000
01:59:39 │ INFO │    └─ Task Time: 56.5s
01:59:39 │ INFO │    📊 Saved model metrics to /app/artifacts/metrics/model_metrics_image_20250629_015939.csv
01:59:39 │ INFO │    🏆 Saved best models to /app/artifacts/metrics/best_models_image_20250629_015939.csv
01:59:39 │ INFO │    📋 Saved training metadata to /app/artifacts/metrics/training_metadata_image_20250629_015939.csv
01:59:39 │ INFO │    📈 Saved model comparison to /app/artifacts/metrics/model_comparison_image_20250629_015939.csv
01:59:39 │ INFO │    🔮 Saved model predictions to /app/artifacts/metrics/model_predictions_image_20250629_015939.csv
01:59:39 │ INFO │ 
🏁 MODE A PIPELINE COMPLETE:
01:59:39 │ INFO │    ├─ Total Time: 137.5s
01:59:39 │ INFO │    ├─ Tasks Completed: 2
01:59:39 │ INFO │    ├─ Models Trained: 6
01:59:39 │ INFO │    └─ Domain: image
01:59:39 │ INFO │ 
📊 ALL RESULTS:
01:59:39 │ INFO │     1.  KETO |        RF_IMAGE | F1=0.957 | ACC=0.955 | Time=4.0s
01:59:39 │ INFO │     2.  KETO |        RF_IMAGE | F1=0.957 | ACC=0.955 | Time=4.0s
01:59:39 │ INFO │     3.  KETO |      LGBM_IMAGE | F1=0.957 | ACC=0.955 | Time=76.7s
01:59:39 │ INFO │     4. VEGAN |        RF_IMAGE | F1=0.986 | ACC=0.985 | Time=4.3s
01:59:39 │ INFO │     5. VEGAN |        RF_IMAGE | F1=0.986 | ACC=0.985 | Time=4.3s
01:59:39 │ INFO │     6. VEGAN |      LGBM_IMAGE | F1=0.986 | ACC=0.985 | Time=52.1s
01:59:39 │ INFO │ 
╭─ MODE A (silver → gold) ───────────────────────────────────
01:59:39 │ INFO │ │ model task     ACC    PREC     REC      F1     ROC      PR │
01:59:39 │ INFO │ ├────────────────────────────────────────────────────────────┤
01:59:39 │ INFO │ │ RF_IMAGE keto     0.95    0.94    0.97    0.96    0.96    0.96 │
01:59:39 │ INFO │ │ RF_IMAGE keto     0.95    0.94    0.97    0.96    0.96    0.96 │
01:59:39 │ INFO │ │ LGBM_IMAGE keto     0.95    0.94    0.97    0.96    0.96    0.96 │
01:59:39 │ INFO │ │ RF_IMAGE vegan    0.98    0.97    1.00    0.99    0.97    0.91 │
01:59:39 │ INFO │ │ RF_IMAGE vegan    0.98    0.97    1.00    0.99    0.97    0.91 │
01:59:39 │ INFO │ │ LGBM_IMAGE vegan    0.98    0.97    1.00    0.99    0.97    0.95 │
01:59:39 │ INFO │ ╰────────────────────────────────────────────────────────────╯
01:59:39 │ INFO │       ✅ Image models: 6 results
01:59:39 │ INFO │ System/Container total memory: 31.3 GB
01:59:39 │ INFO │ Safe memory limit (100%): 31.3 GB
01:59:39 │ INFO │    🧹 Image Models: Memory optimization
01:59:39 │ INFO │       ├─ Container/System memory: 31.3 GB total
01:59:39 │ INFO │       ├─ Currently used: 32.0% (9620 MB)
01:59:39 │ INFO │       ├─ Freed: 0.0 MB RAM
01:59:39 │ INFO │       ├─ Objects collected: 8
01:59:39 │ INFO │       ✅ Memory usage normal: 32.0%
01:59:39 │ INFO │    🔤 Training text-based models...
01:59:39 │ INFO │ 🚀 Starting MODE A Training Pipeline
01:59:39 │ INFO │    Domain: text
01:59:39 │ INFO │    SMOTE enabled: True
01:59:40 │ INFO │    Silver set size: 225,905
01:59:40 │ INFO │    Gold set size: 100
01:59:40 │ INFO │    Feature dimensions: (225905, 50000)
01:59:40 │ INFO │ 
📊 Class Distribution Analysis:
01:59:40 │ INFO │     Keto - Silver: 36,885/225,905 (16.3%) | Gold: 40/100 (40.0%)
01:59:40 │ INFO │    Vegan - Silver: 16,378.0/225,905 (7.2%) | Gold: 40/100 (40.0%)
01:59:40 │ INFO │ 
🎯 Processing KETO classification:
01:59:40 │ INFO │    Training labels - Positive: 36,885 (16.3%)
01:59:40 │ INFO │    Test labels - Positive: 40 (40.0%)
01:59:40 │ INFO │    Minority class ratio: 16.3%
01:59:40 │ INFO │    🔄 Applying SMOTE (minority < 30%)...
01:59:40 │ INFO │    ✅ SMOTE completed in 0.1s
01:59:40 │ INFO │    ├─ Size: 225,905 → 378,040 (1.7x)
01:59:40 │ INFO │    └─ Minority ratio: 16.3% → 50.0%
01:59:40 │ INFO │    🤖 Training 6 models: ['NB', 'Softmax', 'Ridge', 'PA', 'SGD', 'LinearSVC']
01:59:40 │ INFO │       ✅      NB_TEXT: F1=0.963 | ACC=0.970 | PREC=0.951 | REC=0.975 | Time=0.1s
01:59:40 │ INFO │       🏆 New best model for keto: NB_TEXT (F1=0.963)
01:59:45 │ INFO │       ✅ Softmax_TEXT: F1=0.963 | ACC=0.970 | PREC=0.951 | REC=0.975 | Time=4.6s
01:59:51 │ INFO │ Adding probability calibration to RidgeClassifier
02:00:06 │ INFO │       ✅   Ridge_TEXT: F1=0.963 | ACC=0.970 | PREC=0.951 | REC=0.975 | Time=21.2s
02:00:07 │ INFO │ Adding probability calibration to PassiveAggressiveClassifier
02:00:12 │ INFO │       ✅      PA_TEXT: F1=0.963 | ACC=0.970 | PREC=0.951 | REC=0.975 | Time=6.3s
02:00:13 │ INFO │       ✅     SGD_TEXT: F1=0.963 | ACC=0.970 | PREC=0.951 | REC=0.975 | Time=1.2s
02:00:19 │ INFO │ Adding probability calibration to LinearSVC
02:00:33 │ INFO │       ✅ LinearSVC_TEXT: F1=0.963 | ACC=0.970 | PREC=0.951 | REC=0.975 | Time=20.1s
02:00:33 │ INFO │    🎯 KETO COMPLETE:
02:00:33 │ INFO │    ├─ Best Model: NB_TEXT (F1=0.963)
02:00:33 │ INFO │    ├─ Final Metrics: ACC=0.970 | PREC=0.951 | REC=0.975
02:00:33 │ INFO │    └─ Task Time: 53.7s
02:00:33 │ WARNING │ Found 303 NaN values in vegan labels, filling with defaults
02:00:33 │ INFO │ 
🎯 Processing VEGAN classification:
02:00:33 │ INFO │    Training labels - Positive: 16,681 (7.4%)
02:00:33 │ INFO │    Test labels - Positive: 40 (40.0%)
02:00:33 │ INFO │    Minority class ratio: 7.4%
02:00:33 │ INFO │    🔄 Applying SMOTE (minority < 30%)...
02:00:33 │ INFO │    ✅ SMOTE completed in 0.1s
02:00:34 │ INFO │    ├─ Size: 225,905 → 418,448 (1.9x)
02:00:34 │ INFO │    └─ Minority ratio: 7.4% → 50.0%
02:00:34 │ INFO │    🤖 Training 6 models: ['NB', 'Softmax', 'Ridge', 'PA', 'SGD', 'LinearSVC']
02:00:34 │ INFO │       ✅      NB_TEXT: F1=0.975 | ACC=0.980 | PREC=0.975 | REC=0.975 | Time=0.1s
02:00:34 │ INFO │       🏆 New best model for vegan: NB_TEXT (F1=0.975)
02:00:37 │ INFO │       ✅ Softmax_TEXT: F1=0.975 | ACC=0.980 | PREC=0.975 | REC=0.975 | Time=3.5s
02:00:45 │ INFO │ Adding probability calibration to RidgeClassifier
02:01:02 │ INFO │       ✅   Ridge_TEXT: F1=0.975 | ACC=0.980 | PREC=0.975 | REC=0.975 | Time=24.7s
02:01:03 │ INFO │ Adding probability calibration to PassiveAggressiveClassifier
02:01:09 │ INFO │       ✅      PA_TEXT: F1=0.975 | ACC=0.980 | PREC=0.975 | REC=0.975 | Time=6.8s
02:01:10 │ INFO │       ✅     SGD_TEXT: F1=0.962 | ACC=0.970 | PREC=0.974 | REC=0.950 | Time=1.2s
02:01:17 │ INFO │ Adding probability calibration to LinearSVC
02:01:38 │ INFO │       ✅ LinearSVC_TEXT: F1=0.975 | ACC=0.980 | PREC=0.975 | REC=0.975 | Time=27.7s
02:01:38 │ INFO │    🎯 VEGAN COMPLETE:
02:01:38 │ INFO │    ├─ Best Model: NB_TEXT (F1=0.975)
02:01:38 │ INFO │    ├─ Final Metrics: ACC=0.980 | PREC=0.975 | REC=0.975
02:01:38 │ INFO │    └─ Task Time: 64.4s
02:01:38 │ INFO │    📊 Saved model metrics to /app/artifacts/metrics/model_metrics_text_20250629_020138.csv
02:01:38 │ INFO │    🏆 Saved best models to /app/artifacts/metrics/best_models_text_20250629_020138.csv
02:01:38 │ INFO │    📋 Saved training metadata to /app/artifacts/metrics/training_metadata_text_20250629_020138.csv
02:01:38 │ INFO │    📈 Saved model comparison to /app/artifacts/metrics/model_comparison_text_20250629_020138.csv
02:01:38 │ INFO │    🔮 Saved model predictions to /app/artifacts/metrics/model_predictions_text_20250629_020138.csv
02:01:38 │ INFO │ 
🏁 MODE A PIPELINE COMPLETE:
02:01:38 │ INFO │    ├─ Total Time: 118.3s
02:01:38 │ INFO │    ├─ Tasks Completed: 2
02:01:38 │ INFO │    ├─ Models Trained: 14
02:01:38 │ INFO │    └─ Domain: text
02:01:38 │ INFO │ 
📊 ALL RESULTS:
02:01:38 │ INFO │     1.  KETO |         NB_TEXT | F1=0.963 | ACC=0.970 | Time=0.1s
02:01:38 │ INFO │     2.  KETO |         NB_TEXT | F1=0.963 | ACC=0.970 | Time=0.1s
02:01:38 │ INFO │     3.  KETO |    Softmax_TEXT | F1=0.963 | ACC=0.970 | Time=4.6s
02:01:38 │ INFO │     4.  KETO |      Ridge_TEXT | F1=0.963 | ACC=0.970 | Time=21.2s
02:01:38 │ INFO │     5.  KETO |         PA_TEXT | F1=0.963 | ACC=0.970 | Time=6.3s
02:01:38 │ INFO │     6.  KETO |        SGD_TEXT | F1=0.963 | ACC=0.970 | Time=1.2s
02:01:38 │ INFO │     7.  KETO |  LinearSVC_TEXT | F1=0.963 | ACC=0.970 | Time=20.1s
02:01:38 │ INFO │     8. VEGAN |         NB_TEXT | F1=0.975 | ACC=0.980 | Time=0.1s
02:01:38 │ INFO │     9. VEGAN |         NB_TEXT | F1=0.975 | ACC=0.980 | Time=0.1s
02:01:38 │ INFO │    10. VEGAN |    Softmax_TEXT | F1=0.975 | ACC=0.980 | Time=3.5s
02:01:38 │ INFO │    11. VEGAN |      Ridge_TEXT | F1=0.975 | ACC=0.980 | Time=24.7s
02:01:38 │ INFO │    12. VEGAN |         PA_TEXT | F1=0.975 | ACC=0.980 | Time=6.8s
02:01:38 │ INFO │    13. VEGAN |        SGD_TEXT | F1=0.962 | ACC=0.970 | Time=1.2s
02:01:38 │ INFO │    14. VEGAN |  LinearSVC_TEXT | F1=0.975 | ACC=0.980 | Time=27.7s
02:01:38 │ INFO │ 
╭─ MODE A (silver → gold) ───────────────────────────────────
02:01:38 │ INFO │ │ model task     ACC    PREC     REC      F1     ROC      PR │
02:01:38 │ INFO │ ├────────────────────────────────────────────────────────────┤
02:01:38 │ INFO │ │ NB_TEXT keto     0.97    0.95    0.97    0.96    0.97    0.94 │
02:01:38 │ INFO │ │ NB_TEXT keto     0.97    0.95    0.97    0.96    0.97    0.94 │
02:01:38 │ INFO │ │ Softmax_TEXT keto     0.97    0.95    0.97    0.96    0.98    0.98 │
02:01:38 │ INFO │ │ Ridge_TEXT keto     0.97    0.95    0.97    0.96    0.98    0.96 │
02:01:38 │ INFO │ │ PA_TEXT keto     0.97    0.95    0.97    0.96    0.98    0.96 │
02:01:38 │ INFO │ │ SGD_TEXT keto     0.97    0.95    0.97    0.96    0.98    0.97 │
02:01:38 │ INFO │ │ LinearSVC_TEXT keto     0.97    0.95    0.97    0.96    0.98    0.96 │
02:01:38 │ INFO │ │ NB_TEXT vegan    0.98    0.97    0.97    0.97    0.97    0.93 │
02:01:38 │ INFO │ │ NB_TEXT vegan    0.98    0.97    0.97    0.97    0.97    0.93 │
02:01:38 │ INFO │ │ Softmax_TEXT vegan    0.98    0.97    0.97    0.97    0.98    0.98 │
02:01:38 │ INFO │ │ Ridge_TEXT vegan    0.98    0.97    0.97    0.97    0.99    0.98 │
02:01:38 │ INFO │ │ PA_TEXT vegan    0.98    0.97    0.97    0.97    0.99    0.98 │
02:01:38 │ INFO │ │ SGD_TEXT vegan    0.97    0.97    0.95    0.96    0.97    0.94 │
02:01:38 │ INFO │ │ LinearSVC_TEXT vegan    0.98    0.97    0.97    0.97    0.99    0.98 │
02:01:38 │ INFO │ ╰────────────────────────────────────────────────────────────╯
02:01:38 │ INFO │       ✅ Text models: 14 results
02:01:38 │ INFO │ System/Container total memory: 31.3 GB
02:01:38 │ INFO │ Safe memory limit (100%): 31.3 GB
02:01:38 │ INFO │    🧹 Text Models: Memory optimization
02:01:38 │ INFO │       ├─ Container/System memory: 31.3 GB total
02:01:38 │ INFO │       ├─ Currently used: 34.6% (10451 MB)
02:01:39 │ INFO │       ├─ Freed: 0.0 MB RAM
02:01:39 │ INFO │       ├─ Objects collected: 50
02:01:39 │ INFO │       ✅ Memory usage normal: 34.6%
02:01:39 │ INFO │    🤝 Creating text+image ensemble...
02:01:39 │ INFO │       ├─ keto: Testing alpha values [0.25, 0.5, 0.75]
02:01:39 │ INFO │ ▶️  BEST-TWO (keto) — text=NB_TEXT (F1=0.963), image=RF_IMAGE
02:01:39 │ INFO │    ├─ Text predictions: 100 samples
02:01:39 │ INFO │    ├─ Image predictions: 66 samples
02:01:39 │ INFO │    └─ Blending with alpha=0.25
02:01:39 │ ERROR │          ❌ alpha=0.25 failed: 'NB'...
02:01:39 │ INFO │ ▶️  BEST-TWO (keto) — text=NB_TEXT (F1=0.963), image=RF_IMAGE
02:01:39 │ INFO │    ├─ Text predictions: 100 samples
02:01:39 │ INFO │    ├─ Image predictions: 66 samples
02:01:39 │ INFO │    └─ Blending with alpha=0.5
02:01:39 │ ERROR │          ❌ alpha=0.5 failed: 'NB'...
02:01:39 │ INFO │ ▶️  BEST-TWO (keto) — text=NB_TEXT (F1=0.963), image=RF_IMAGE
02:01:39 │ INFO │    ├─ Text predictions: 100 samples
02:01:39 │ INFO │    ├─ Image predictions: 66 samples
02:01:39 │ INFO │    └─ Blending with alpha=0.75
02:01:39 │ ERROR │          ❌ alpha=0.75 failed: 'NB'...
02:01:39 │ WARNING │       ⚠️  Ensemble failed for keto, using best text model
02:01:39 │ INFO │       ├─ vegan: Testing alpha values [0.25, 0.5, 0.75]
02:01:39 │ INFO │ ▶️  BEST-TWO (vegan) — text=NB_TEXT (F1=0.975), image=RF_IMAGE
02:01:39 │ INFO │    ├─ Text predictions: 100 samples
02:01:39 │ INFO │    ├─ Image predictions: 66 samples
02:01:39 │ INFO │    └─ Blending with alpha=0.25
02:01:39 │ ERROR │          ❌ alpha=0.25 failed: 'NB'...
02:01:39 │ INFO │ ▶️  BEST-TWO (vegan) — text=NB_TEXT (F1=0.975), image=RF_IMAGE
02:01:39 │ INFO │    ├─ Text predictions: 100 samples
02:01:39 │ INFO │    ├─ Image predictions: 66 samples
02:01:39 │ INFO │    └─ Blending with alpha=0.5
02:01:39 │ ERROR │          ❌ alpha=0.5 failed: 'NB'...
02:01:39 │ INFO │ ▶️  BEST-TWO (vegan) — text=NB_TEXT (F1=0.975), image=RF_IMAGE
02:01:39 │ INFO │    ├─ Text predictions: 100 samples
02:01:39 │ INFO │    ├─ Image predictions: 66 samples
02:01:39 │ INFO │    └─ Blending with alpha=0.75
02:01:39 │ ERROR │          ❌ alpha=0.75 failed: 'NB'...
02:01:39 │ WARNING │       ⚠️  Ensemble failed for vegan, using best text model
02:01:39 │ INFO │ 
╭─ Text+Image Ensembles ─────────────────────────────────────
02:01:39 │ INFO │ │ model task     ACC    PREC     REC      F1     ROC      PR │
02:01:39 │ INFO │ ├────────────────────────────────────────────────────────────┤
02:01:39 │ INFO │ │ NB_TEXT keto     0.97    0.95    0.97    0.96    0.97    0.94 │
02:01:39 │ INFO │ │ NB_TEXT vegan    0.98    0.97    0.97    0.97    0.97    0.93 │
02:01:39 │ INFO │ ╰────────────────────────────────────────────────────────────╯
02:01:39 │ INFO │       ✅ Created 2 ensemble configurations
02:01:39 │ INFO │    🔄 Training final combined models...
02:01:44 │ INFO │       ├─ Combined silver features: (72422, 52048)
02:01:44 │ INFO │       ├─ Combined gold features: (66, 52048)
02:01:44 │ INFO │       ├─ Silver samples: 72,422
02:01:44 │ INFO │       └─ Gold samples: 66
02:01:44 │ INFO │ 🚀 Starting MODE A Training Pipeline
02:01:44 │ INFO │    Domain: both
02:01:44 │ INFO │    SMOTE enabled: True
02:01:44 │ INFO │    Silver set size: 72,422
02:01:44 │ INFO │    Gold set size: 66
02:01:44 │ INFO │    Feature dimensions: (72422, 52048)
02:01:44 │ INFO │ 
📊 Class Distribution Analysis:
02:01:44 │ INFO │     Keto - Silver: 11,786/72,422 (16.3%) | Gold: 34/66 (51.5%)
02:01:44 │ INFO │    Vegan - Silver: 5,224.0/72,422 (7.2%) | Gold: 35/66 (53.0%)
02:01:44 │ INFO │ 
🎯 Processing KETO classification:
02:01:44 │ INFO │    Training labels - Positive: 11,786 (16.3%)
02:01:44 │ INFO │    Test labels - Positive: 34 (51.5%)
02:01:44 │ INFO │    Minority class ratio: 16.3%
02:01:44 │ INFO │    🔄 Applying SMOTE (minority < 30%)...
02:01:45 │ INFO │    ✅ SMOTE completed in 0.5s
02:01:45 │ INFO │    ├─ Size: 72,422 → 121,272 (1.7x)
02:01:45 │ INFO │    └─ Minority ratio: 16.3% → 50.0%
02:01:45 │ INFO │    🤖 Training 8 models: ['NB', 'Softmax', 'Ridge', 'PA', 'SGD', 'LinearSVC', 'RF', 'LGBM']
02:01:45 │ INFO │       ✅      NB_BOTH: F1=0.957 | ACC=0.955 | PREC=0.943 | REC=0.971 | Time=0.4s
02:01:45 │ INFO │       🏆 New best model for keto: NB_BOTH (F1=0.957)

================================================================================
NEW RUN STARTED AT 2025-06-29 02:01:48
Process ID: 471
================================================================================
02:01:48 │ INFO │ Logging system initialized successfully
02:01:50 │ INFO │ USDA carb table loaded: 303 distinct food descriptions
02:01:50 │ INFO │ Carb map initialised (303 keys)
02:01:50 │ INFO │ ✅ All sanity checks passed
02:04:32 │ INFO │       ✅ Softmax_BOTH: F1=0.941 | ACC=0.939 | PREC=0.941 | REC=0.941 | Time=166.9s

================================================================================
NEW RUN STARTED AT 2025-06-29 02:04:33
Process ID: 521
================================================================================
02:04:33 │ INFO │ Logging system initialized successfully
02:04:35 │ INFO │ USDA carb table loaded: 303 distinct food descriptions
02:04:35 │ INFO │ Carb map initialised (303 keys)
02:04:35 │ INFO │ ✅ All sanity checks passed

================================================================================
NEW RUN STARTED AT 2025-06-29 02:06:45
Process ID: 570
================================================================================
02:06:45 │ INFO │ Logging system initialized successfully
02:06:47 │ INFO │ USDA carb table loaded: 303 distinct food descriptions
02:06:47 │ INFO │ Carb map initialised (303 keys)
02:06:47 │ INFO │ ✅ All sanity checks passed

================================================================================
NEW RUN STARTED AT 2025-06-29 02:07:38
Process ID: 619
================================================================================
02:07:38 │ INFO │ Logging system initialized successfully
02:07:40 │ INFO │ USDA carb table loaded: 303 distinct food descriptions
02:07:41 │ INFO │ Carb map initialised (303 keys)
02:07:41 │ INFO │ ✅ All sanity checks passed

================================================================================
NEW RUN STARTED AT 2025-06-29 02:08:05
Process ID: 668
================================================================================
02:08:05 │ INFO │ Logging system initialized successfully
02:08:07 │ INFO │ USDA carb table loaded: 303 distinct food descriptions
02:08:07 │ INFO │ Carb map initialised (303 keys)
02:08:07 │ INFO │ ✅ All sanity checks passed
