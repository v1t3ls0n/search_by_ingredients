
================================================================================
NEW RUN STARTED AT 2025-06-28 19:36:46
Process ID: 103
================================================================================
19:36:46 │ INFO │ Logging system initialized successfully
19:36:47 │ INFO │ USDA carb table loaded: 303 distinct food descriptions
19:36:48 │ INFO │ Carb map initialised (303 keys)
19:36:48 │ INFO │ ✅ All sanity checks passed
19:36:48 │ INFO │ 🚀 Starting main with args: Namespace(ground_truth=None, train=True, ingredients=None, mode='both', force=False, sample_frac=1.0)
19:36:48 │ INFO │ System/Container total memory: 31.3 GB
19:36:48 │ INFO │ Safe memory limit (90%): 28.1 GB
19:36:48 │ INFO │ 💾 Available memory for processing: 28.1 GB
19:36:48 │ WARNING │ ⚠️  Limited memory detected. Enabling memory optimizations...
19:36:48 │ INFO │ 🚀 Starting main with args: Namespace(ground_truth=None, train=True, ingredients=None, mode='both', force=False, sample_frac=1.0)
19:36:48 │ INFO │ 🧠 SINGLE training run - sample_frac=1.0
19:36:48 │ INFO │ 🚀 STARTING FULL ML PIPELINE
19:36:48 │ INFO │    Mode: both
19:36:48 │ INFO │    Force recomputation: False
19:36:48 │ INFO │    Sample fraction: 1.0
19:36:48 │ INFO │    Start time: 2025-06-28 19:36:48
19:36:48 │ INFO │    Available CPU cores: 24
19:36:48 │ INFO │    Available memory: 31 GB
19:36:48 │ INFO │ 
📂 STAGE 1: DATA LOADING AND PREPARATION
19:36:48 │ INFO │ 
📂 DATASET LOADING PIPELINE
19:36:48 │ INFO │    Configuration: 2 data sources
19:36:48 │ INFO │    Data directory: /app/data
19:36:48 │ INFO │    📊 Data Sources:
19:36:48 │ INFO │    ├─ allrecipes.parquet: Local
19:36:48 │ INFO │    │  └─ /app/data/allrecipes.parquet
19:36:48 │ INFO │    ├─ ground_truth_sample.csv: Local
19:36:48 │ INFO │    │  └─ /app/data/ground_truth_sample.csv
19:36:48 │ INFO │ 
   🍳 STAGE 1: LOADING RECIPES DATASET
19:36:48 │ INFO │    ├─ Source: /app/data/allrecipes.parquet
19:36:48 │ INFO │       ├─ Local file size: 49.2 MB
19:36:48 │ INFO │       📊 Recipes Dataset:
19:36:48 │ INFO │       ├─ Shape: (225602, 5)
19:36:48 │ INFO │       ├─ Columns: ['title', 'description', 'instructions', 'ingredients', 'photo_url']
19:36:48 │ INFO │       ├─ Memory usage: 145.4 MB
19:36:48 │ INFO │       └─ Load time: 0.4s
19:36:52 │ INFO │       📈 Data Quality:
19:36:52 │ INFO │       ├─ Total recipes: 225,602
19:36:52 │ INFO │       ├─ Null ingredients: 0
19:36:52 │ INFO │       ├─ Empty ingredients: 0
19:36:52 │ INFO │       └─ With photos: 225,602 (100.0%)
19:36:52 │ INFO │    ✅ Recipes loaded successfully in 3.8s
19:36:52 │ INFO │       💾 Recipes loaded: 14.3% memory used (3958 MB / 32015 MB)
19:36:52 │ INFO │ 
   🎯 STAGE 2: LOADING GROUND TRUTH DATASET
19:36:52 │ INFO │    ├─ Source: /app/data/ground_truth_sample.csv
19:36:52 │ INFO │       ├─ File size: 79.1 KB
19:36:52 │ INFO │       📊 Ground Truth Dataset:
19:36:52 │ INFO │       ├─ Shape: (100, 7)
19:36:52 │ INFO │       ├─ Columns: ['title', 'description', 'instructions', 'ingredients', 'photo_url', 'vegan', 'keto']
19:36:52 │ INFO │       ├─ Keto columns found: ['keto']
19:36:52 │ INFO │       ├─ Vegan columns found: ['vegan']
19:36:52 │ INFO │       └─ Load time: 0.00s
19:36:52 │ INFO │       ├─ Keto labels: 40/100 (40.0% positive)
19:36:52 │ INFO │       ├─ Vegan labels: 40/100 (40.0% positive)
19:36:52 │ INFO │    ✅ Ground truth loaded successfully in 0.1s
19:36:52 │ INFO │       💾 Ground truth loaded: 14.3% memory used (3958 MB / 32015 MB)
19:36:52 │ INFO │ 
   🥈 STAGE 3: GENERATING SILVER LABELS

================================================================================
NEW RUN STARTED AT 2025-06-28 19:37:15
Process ID: 36
================================================================================
19:37:15 │ INFO │ Logging system initialized successfully
19:37:17 │ INFO │ USDA carb table loaded: 303 distinct food descriptions
19:37:17 │ INFO │ Carb map initialised (303 keys)
19:37:17 │ INFO │ ✅ All sanity checks passed

================================================================================
NEW RUN STARTED AT 2025-06-28 19:37:20
Process ID: 160
================================================================================
19:37:20 │ INFO │ Logging system initialized successfully
19:37:22 │ INFO │ USDA carb table loaded: 303 distinct food descriptions
19:37:22 │ INFO │ Carb map initialised (303 keys)
19:37:22 │ INFO │ ✅ All sanity checks passed
19:38:34 │ INFO │       📊 Silver Labels Generated:
19:38:34 │ INFO │       ├─ Total recipes: 225,602
19:38:34 │ INFO │       ├─ Keto positive: 36,722 (16.3%)
19:38:34 │ INFO │       ├─ Vegan positive: 16,378 (7.3%)
19:38:34 │ INFO │       ├─ With photos: 225,602 (100.0%)
19:38:34 │ INFO │       └─ Generation time: 101.8s
19:38:34 │ INFO │    ✅ Silver labels generated successfully in 101.8s
19:38:34 │ INFO │       💾 Silver labels generated: 17.8% memory used (5084 MB / 32015 MB)
19:38:34 │ INFO │ 
   ✅ STAGE 4: DATA VALIDATION AND CROSS-CHECKS
19:38:34 │ INFO │       💾 Memory Usage by Dataset:
19:38:34 │ INFO │       ├─ Recipes: 145.4 MB
19:38:34 │ INFO │       ├─ Silver: 106.4 MB
19:38:34 │ INFO │       ├─ Ground_truth: 0.1 MB
19:38:34 │ INFO │       └─ Total: 251.9 MB
19:38:34 │ INFO │       📊 Label Distribution Comparison:
19:38:34 │ INFO │       ├─ Keto: Gold=40.0%, Silver=16.3%
19:38:34 │ INFO │       └─ Vegan: Gold=40.0%, Silver=7.3%
19:38:34 │ WARNING │       ⚠️  Large keto distribution difference: 23.7%
19:38:34 │ WARNING │       ⚠️  Large vegan distribution difference: 32.7%
19:38:34 │ INFO │       ✅ Validation Summary:
19:38:34 │ INFO │       ├─ Recipes Loaded: ✅
19:38:34 │ INFO │       ├─ Ground Truth Loaded: ✅
19:38:34 │ INFO │       ├─ Silver Generated: ✅
19:38:34 │ INFO │       ├─ Required Columns Present: ✅
19:38:34 │ INFO │       ├─ Labels Processed: ✅
19:38:34 │ INFO │       ├─ Consistency Issues: 0
19:38:34 │ INFO │    ✅ Data validation completed in 0.4s
19:38:34 │ INFO │       💾 Validation complete: 17.8% memory used (5103 MB / 32015 MB)
19:38:34 │ INFO │ USDA carb table loaded: 303 distinct food descriptions
19:38:34 │ INFO │    ✅ USDA table loaded in 0.1s – 303 rows
19:38:34 │ INFO │ 
🏁 DATASET LOADING COMPLETE
19:38:34 │ INFO │    ├─ Total loading time: 106.5s
19:38:34 │ INFO │    ├─ Datasets loaded: 4 (recipes, ground_truth, silver, usda)
19:38:34 │ INFO │    ├─ Total memory usage: 251.9 MB
19:38:34 │ INFO │    └─ All validations passed: ✅
19:38:34 │ INFO │ 
   📋 Final Dataset Summary:
19:38:34 │ INFO │    ├─ Recipes: 225,602 rows × 5 columns
19:38:34 │ INFO │    ├─ Ground Truth: 100 rows × 10 columns
19:38:34 │ INFO │    ├─ Silver Labels: 225,602 rows × 5 columns
19:38:34 │ INFO │    ├─ USDA Carb Tbl:  303 rows × 2 columns (0.0 MB)
19:38:34 │ INFO │    ├─ Total memory usage: 251.9 MB
19:38:34 │ INFO │    └─ Ready for ML pipeline: ✅
19:38:35 │ INFO │ 
   📊 Dataset Statistics:
19:38:35 │ INFO │    ├─ Silver (All): 225,602 recipes
19:38:35 │ INFO │    ├─ Silver (Text): 225,602 recipes
19:38:35 │ INFO │    ├─ Silver (Images): 72,485 recipes
19:38:35 │ INFO │    ├─ Gold (All): 100 recipes
19:38:35 │ INFO │    └─ Gold (Images): 66 recipes
19:38:35 │ INFO │ 
   ⚖️  Class Balance Analysis:
19:38:35 │ INFO │ 
── Gold set set class counts ─────────────
19:38:35 │ INFO │  keto:     40/100 (40.0%)
19:38:35 │ INFO │ vegan:     40/100 (40.0%)
19:38:35 │ INFO │ 
── Silver (Text) set set class counts ─────────────
19:38:35 │ INFO │  keto:  36722/225602 (16.3%)
19:38:35 │ INFO │ vegan:  16378/225602 ( 7.3%)
19:38:35 │ INFO │ 
── Silver (Image) set set class counts ─────────────
19:38:35 │ INFO │  keto:  28518/72485 (39.3%)
19:38:35 │ INFO │ vegan:  12577/72485 (17.4%)
19:38:35 │ INFO │    ✅ Data loading completed in 107.2s
19:38:35 │ INFO │    📊 Data Loading - Memory: 17.9% used (5135 MB / 32015 MB)
19:38:35 │ INFO │ System/Container total memory: 31.3 GB
19:38:35 │ INFO │ Safe memory limit (100%): 31.3 GB
19:38:35 │ INFO │    🧹 Data Loading: Memory optimization
19:38:35 │ INFO │       ├─ Container/System memory: 31.3 GB total
19:38:35 │ INFO │       ├─ Currently used: 17.9% (5136 MB)
19:38:35 │ INFO │       ✅ Memory usage normal: 17.9%
19:38:35 │ INFO │ 
🔤 STAGE 2: TEXT FEATURE PROCESSING
19:38:35 │ INFO │    ├─ Vectorizer config: {'min_df': 2, 'ngram_range': (1, 3), 'max_features': 50000, 'sublinear_tf': True}
19:38:35 │ INFO │ USDA carb table loaded: 303 distinct food descriptions
19:38:36 │ INFO │    ├─ USDA examples added: 303
19:38:49 │ INFO │    📊 Text Processing Results:
19:38:49 │ INFO │    ├─ Vocabulary size: 50,000
19:38:49 │ INFO │    ├─ Silver features: (225905, 50000)
19:38:49 │ INFO │    ├─ Gold features: (100, 50000)
19:38:49 │ INFO │    ├─ Sparsity: 0.0%
19:38:49 │ INFO │    └─ Memory usage: ~103 MB
19:38:49 │ INFO │    ✅ Text processing completed in 13.3s
19:38:49 │ INFO │    📊 Text Processing - Memory: 18.7% used (5366 MB / 32015 MB)
19:38:49 │ INFO │ System/Container total memory: 31.3 GB
19:38:49 │ INFO │ Safe memory limit (100%): 31.3 GB
19:38:49 │ INFO │    🧹 Text Processing: Memory optimization
19:38:49 │ INFO │       ├─ Container/System memory: 31.3 GB total
19:38:49 │ INFO │       ├─ Currently used: 18.7% (5366 MB)
19:38:49 │ INFO │       ├─ Freed: 2.1 MB RAM
19:38:49 │ INFO │       ✅ Memory usage normal: 18.6%
19:38:49 │ INFO │ 
🖼️  STAGE 3: IMAGE FEATURE PROCESSING
19:38:49 │ INFO │    ├─ Processing 72,485 sampled silver images
19:38:49 │ INFO │    └─ Processing 66 gold images
19:38:49 │ INFO │ 
🧠 EMBEDDINGS-FIRST IMAGE PIPELINE: silver
19:38:49 │ INFO │    Target directory: dataset/arg_max/images/silver
19:38:49 │ INFO │    Total samples: 72,485
19:38:49 │ INFO │    Force recompute: False
19:38:49 │ INFO │    🔍 Searching for existing embeddings...
19:38:49 │ INFO │    ✅ EMBEDDINGS FOUND: /app/artifacts/embeddings_silver_backup.npy
19:38:49 │ INFO │       ├─ Shape: (72422, 2048)
19:38:49 │ INFO │       ├─ Coverage: 99.9% (72,422/72,485)
19:38:49 │ INFO │       ├─ File size: 565.8 MB
19:38:49 │ INFO │       └─ 🚀 SKIPPING IMAGE DOWNLOADS!
19:38:49 │ INFO │       ├─ Silver download: 72,422/72,485 successful
19:38:49 │ INFO │ 
🧠 EMBEDDINGS-FIRST IMAGE PIPELINE: gold
19:38:49 │ INFO │    Target directory: dataset/arg_max/images/gold
19:38:49 │ INFO │    Total samples: 66
19:38:49 │ INFO │    Force recompute: False
19:38:49 │ INFO │    🔍 Searching for existing embeddings...
19:38:49 │ INFO │    ✅ EMBEDDINGS FOUND: /app/artifacts/embeddings_gold_backup.npy
19:38:49 │ INFO │       ├─ Shape: (66, 2048)
19:38:49 │ INFO │       ├─ Coverage: 100.0% (66/66)
19:38:49 │ INFO │       ├─ File size: 0.5 MB
19:38:49 │ INFO │       └─ 🚀 SKIPPING IMAGE DOWNLOADS!
19:38:49 │ INFO │       ├─ Gold download: 66/66 successful
19:38:50 │ INFO │       ├─ Silver filtered: 72,422 with valid images
19:38:50 │ INFO │       ├─ Gold filtered: 66 with valid images
19:38:50 │ INFO │       ├─ Gold filtered: 66 with valid images
19:38:50 │ INFO │ System/Container total memory: 31.3 GB
19:38:50 │ INFO │ Safe memory limit (90%): 28.1 GB
19:38:50 │ INFO │    💾 Memory-aware batch size: 16 (based on 28.1 GB available)
19:38:50 │ INFO │ 
🧠 IMAGE EMBEDDING EXTRACTION: silver
19:38:50 │ INFO │    Target images: 72,422
19:38:50 │ INFO │    Mode: silver
19:38:50 │ INFO │    Force recomputation: False
19:38:50 │ INFO │    🔧 Device Configuration:
19:38:50 │ INFO │    ├─ Device: cpu
19:38:50 │ INFO │    ├─ CUDA available: False
19:38:51 │ INFO │    ✅ Using cached embeddings from Artifacts backup
19:38:51 │ INFO │       ├─ Silver embeddings: (72422, 2048)
19:38:51 │ INFO │       ├─ Silver DataFrame: 72,422 rows
19:38:51 │ INFO │ System/Container total memory: 31.3 GB
19:38:51 │ INFO │ Safe memory limit (90%): 28.1 GB
19:38:51 │ INFO │    💾 Memory-aware batch size: 16 (based on 28.1 GB available)
19:38:51 │ INFO │ 
🧠 IMAGE EMBEDDING EXTRACTION: gold
19:38:51 │ INFO │    Target images: 66
19:38:51 │ INFO │    Mode: gold
19:38:51 │ INFO │    Force recomputation: False
19:38:51 │ INFO │    🔧 Device Configuration:
19:38:51 │ INFO │    ├─ Device: cpu
19:38:51 │ INFO │    ├─ CUDA available: False
19:38:51 │ INFO │    ✅ Using cached embeddings from Artifacts backup
19:38:51 │ INFO │       ├─ Gold embeddings: (66, 2048)
19:38:51 │ INFO │       ├─ Gold DataFrame: 66 rows
19:38:51 │ INFO │       ├─ Saved gold embeddings to embeddings/img_gold.pkl
19:38:51 │ INFO │       ├─ Saved silver embeddings to embeddings/img_silver.pkl
19:38:52 │ INFO │    🔍 DIMENSION VERIFICATION:
19:38:52 │ INFO │    ├─ Silver embeddings: (72422, 2048)
19:38:52 │ INFO │    ├─ Silver DataFrame: 72,422 rows
19:38:52 │ INFO │    ├─ Gold embeddings: (66, 2048)
19:38:52 │ INFO │    └─ Gold DataFrame: 66 rows
19:38:53 │ INFO │    📊 Image Processing Results:
19:38:53 │ INFO │    ├─ Silver images available: 72,485
19:38:53 │ INFO │    ├─ Silver images downloaded: 72,422
19:38:53 │ INFO │    ├─ Silver valid embeddings: 72,422
19:38:53 │ INFO │    ├─ Gold images available: 66
19:38:53 │ INFO │    ├─ Gold images downloaded: 66
19:38:53 │ INFO │    ├─ Gold valid embeddings: 66
19:38:53 │ INFO │    ├─ Silver embedding size: 565 MB
19:38:53 │ INFO │    └─ Gold embedding size: 0 MB
19:38:53 │ INFO │    ✅ Image processing completed in 4.2s
19:38:53 │ INFO │    📊 Image Processing - Memory: 21.7% used (6328 MB / 32015 MB)
19:38:53 │ INFO │ System/Container total memory: 31.3 GB
19:38:53 │ INFO │ Safe memory limit (100%): 31.3 GB
19:38:53 │ INFO │    🧹 Image Processing: Memory optimization
19:38:53 │ INFO │       ├─ Container/System memory: 31.3 GB total
19:38:53 │ INFO │       ├─ Currently used: 21.7% (6328 MB)
19:38:54 │ INFO │       ├─ Freed: 0.0 MB RAM
19:38:54 │ INFO │       ├─ Objects collected: 44
19:38:54 │ INFO │       ✅ Memory usage normal: 21.7%
19:38:54 │ INFO │ 
🤖 STAGE 4: MODEL TRAINING
19:38:54 │ INFO │    🖼️  Training image-based models...
19:38:54 │ INFO │    📊 Mode='both' detected - using combined text+image features
19:38:58 │ INFO │       ├─ Combined features for image models: (72422, 52048)
19:38:58 │ INFO │       ├─ Samples: 72422 silver, 66 gold
19:38:58 │ INFO │ 🚀 Starting MODE A Training Pipeline
19:38:58 │ INFO │    Domain: image
19:38:58 │ INFO │    SMOTE enabled: False
19:38:58 │ INFO │    Silver set size: 72,422
19:38:58 │ INFO │    Gold set size: 66
19:38:58 │ INFO │    Feature dimensions: (72422, 52048)
19:38:58 │ INFO │ 
📊 Class Distribution Analysis:
19:38:58 │ INFO │     Keto - Silver: 11,786/72,422 (16.3%) | Gold: 34/66 (51.5%)
19:38:58 │ INFO │    Vegan - Silver: 5,224.0/72,422 (7.2%) | Gold: 35/66 (53.0%)
19:38:58 │ INFO │ 
🎯 Processing KETO classification:
19:38:58 │ INFO │    Training labels - Positive: 11,786 (16.3%)
19:38:58 │ INFO │    Test labels - Positive: 34 (51.5%)
19:38:58 │ INFO │    ⏭️  SMOTE disabled, using original data
19:38:58 │ INFO │    🤖 Training 2 models: ['RF', 'LGBM']
19:39:33 │ INFO │       ✅     RF_IMAGE: F1=0.912 | ACC=0.909 | PREC=0.912 | REC=0.912 | Time=35.2s
19:39:33 │ INFO │       🏆 New best model for keto: RF_IMAGE (F1=0.912)
19:40:47 │ INFO │       ✅   LGBM_IMAGE: F1=0.957 | ACC=0.955 | PREC=0.943 | REC=0.971 | Time=73.4s
19:40:47 │ INFO │       🏆 New best model for keto: LGBM_IMAGE (F1=0.957)
19:40:47 │ INFO │    🎯 KETO COMPLETE:
19:40:47 │ INFO │    ├─ Best Model: LGBM_IMAGE (F1=0.957)
19:40:47 │ INFO │    ├─ Final Metrics: ACC=0.955 | PREC=0.943 | REC=0.971
19:40:47 │ INFO │    └─ Task Time: 108.7s
19:40:47 │ INFO │ 
🎯 Processing VEGAN classification:
19:40:47 │ INFO │    Training labels - Positive: 5,224 (7.2%)
19:40:47 │ INFO │    Test labels - Positive: 35 (53.0%)
19:40:47 │ INFO │    ⏭️  SMOTE disabled, using original data
19:40:47 │ INFO │    🤖 Training 2 models: ['RF', 'LGBM']
19:41:13 │ INFO │       ✅     RF_IMAGE: F1=0.814 | ACC=0.833 | PREC=1.000 | REC=0.686 | Time=26.3s
19:41:13 │ INFO │       🏆 New best model for vegan: RF_IMAGE (F1=0.814)
19:42:24 │ INFO │       ✅   LGBM_IMAGE: F1=0.986 | ACC=0.985 | PREC=0.972 | REC=1.000 | Time=71.0s
19:42:24 │ INFO │       🏆 New best model for vegan: LGBM_IMAGE (F1=0.986)
19:42:24 │ INFO │    🎯 VEGAN COMPLETE:
19:42:24 │ INFO │    ├─ Best Model: LGBM_IMAGE (F1=0.986)
19:42:24 │ INFO │    ├─ Final Metrics: ACC=0.985 | PREC=0.972 | REC=1.000
19:42:24 │ INFO │    └─ Task Time: 97.4s
19:42:24 │ INFO │ 
🏁 MODE A PIPELINE COMPLETE:
19:42:24 │ INFO │    ├─ Total Time: 206.3s
19:42:24 │ INFO │    ├─ Tasks Completed: 2
19:42:24 │ INFO │    └─ Domain: image
19:42:24 │ INFO │ 
📊 FINAL RESULTS SUMMARY:
19:42:24 │ INFO │    1.  KETO |      LGBM_IMAGE | F1=0.957 | ACC=0.955 | Time=73.4s
19:42:24 │ INFO │    2. VEGAN |      LGBM_IMAGE | F1=0.986 | ACC=0.985 | Time=71.0s
19:42:24 │ INFO │ 
╭─ MODE A (silver → gold) ───────────────────────────────────
19:42:24 │ INFO │ │ model task     ACC    PREC     REC      F1     ROC      PR │
19:42:24 │ INFO │ ├────────────────────────────────────────────────────────────┤
19:42:24 │ INFO │ │ LGBM_IMAGE keto     0.95    0.94    0.97    0.96    0.95    0.94 │
19:42:24 │ INFO │ │ LGBM_IMAGE vegan    0.98    0.97    1.00    0.99    0.97    0.95 │
19:42:24 │ INFO │ ╰────────────────────────────────────────────────────────────╯
19:42:24 │ INFO │       ✅ Image models: 2 results
19:42:24 │ INFO │ System/Container total memory: 31.3 GB
19:42:25 │ INFO │ Safe memory limit (100%): 31.3 GB
19:42:25 │ INFO │    🧹 Image Models: Memory optimization
19:42:25 │ INFO │       ├─ Container/System memory: 31.3 GB total
19:42:25 │ INFO │       ├─ Currently used: 33.9% (10248 MB)
19:42:25 │ INFO │       ├─ Freed: 0.0 MB RAM
19:42:25 │ INFO │       ├─ Objects collected: 23
19:42:25 │ INFO │       ✅ Memory usage normal: 33.9%
19:42:25 │ INFO │    🔤 Training text-based models...
19:42:25 │ INFO │ 🚀 Starting MODE A Training Pipeline
19:42:25 │ INFO │    Domain: text
19:42:25 │ INFO │    SMOTE enabled: True
19:42:25 │ INFO │    Silver set size: 225,905
19:42:25 │ INFO │    Gold set size: 100
19:42:25 │ INFO │    Feature dimensions: (225905, 50000)
19:42:25 │ INFO │ 
📊 Class Distribution Analysis:
19:42:25 │ INFO │     Keto - Silver: 36,885/225,905 (16.3%) | Gold: 40/100 (40.0%)
19:42:25 │ INFO │    Vegan - Silver: 16,378.0/225,905 (7.2%) | Gold: 40/100 (40.0%)
19:42:25 │ INFO │ 
🎯 Processing KETO classification:
19:42:25 │ INFO │    Training labels - Positive: 36,885 (16.3%)
19:42:25 │ INFO │    Test labels - Positive: 40 (40.0%)
19:42:25 │ INFO │    Minority class ratio: 16.3%
19:42:25 │ INFO │    🔄 Applying SMOTE (minority < 30%)...
19:42:25 │ INFO │    ✅ SMOTE completed in 0.1s
19:42:25 │ INFO │    ├─ Size: 225,905 → 378,040 (1.7x)
19:42:25 │ INFO │    └─ Minority ratio: 16.3% → 50.0%
19:42:25 │ INFO │    🤖 Training 6 models: ['Rule', 'NB', 'Softmax', 'Ridge', 'PA', 'SGD']
19:42:25 │ ERROR │       ❌ Rule: Prediction failed - sparse array length is ambiguous; use ge...
19:42:25 │ INFO │       ✅      NB_TEXT: F1=0.963 | ACC=0.970 | PREC=0.951 | REC=0.975 | Time=0.1s
19:42:25 │ INFO │       🏆 New best model for keto: NB_TEXT (F1=0.963)
19:42:30 │ INFO │       ✅ Softmax_TEXT: F1=0.963 | ACC=0.970 | PREC=0.951 | REC=0.975 | Time=4.6s
19:42:37 │ INFO │ Adding probability calibration to RidgeClassifier
19:42:50 │ INFO │       ✅   Ridge_TEXT: F1=0.963 | ACC=0.970 | PREC=0.951 | REC=0.975 | Time=19.5s
19:42:51 │ INFO │ Adding probability calibration to PassiveAggressiveClassifier
19:42:56 │ INFO │       ✅      PA_TEXT: F1=0.963 | ACC=0.970 | PREC=0.951 | REC=0.975 | Time=6.3s
19:42:57 │ INFO │       ✅     SGD_TEXT: F1=0.963 | ACC=0.970 | PREC=0.951 | REC=0.975 | Time=1.1s
19:42:57 │ INFO │    🎯 KETO COMPLETE:
19:42:57 │ INFO │    ├─ Best Model: NB_TEXT (F1=0.963)
19:42:57 │ INFO │    ├─ Final Metrics: ACC=0.970 | PREC=0.951 | REC=0.975
19:42:57 │ INFO │    └─ Task Time: 32.0s
19:42:57 │ WARNING │ Found 303 NaN values in vegan labels, filling with defaults
19:42:57 │ INFO │ 
🎯 Processing VEGAN classification:
19:42:57 │ INFO │    Training labels - Positive: 16,681 (7.4%)
19:42:57 │ INFO │    Test labels - Positive: 40 (40.0%)
19:42:57 │ INFO │    Minority class ratio: 7.4%
19:42:57 │ INFO │    🔄 Applying SMOTE (minority < 30%)...
19:42:57 │ INFO │    ✅ SMOTE completed in 0.1s
19:42:57 │ INFO │    ├─ Size: 225,905 → 418,448 (1.9x)
19:42:57 │ INFO │    └─ Minority ratio: 7.4% → 50.0%
19:42:57 │ INFO │    🤖 Training 6 models: ['Rule', 'NB', 'Softmax', 'Ridge', 'PA', 'SGD']
19:42:57 │ ERROR │       ❌ Rule: Prediction failed - sparse array length is ambiguous; use ge...
19:42:57 │ INFO │       ✅      NB_TEXT: F1=0.975 | ACC=0.980 | PREC=0.975 | REC=0.975 | Time=0.1s
19:42:57 │ INFO │       🏆 New best model for vegan: NB_TEXT (F1=0.975)
19:43:01 │ INFO │       ✅ Softmax_TEXT: F1=0.975 | ACC=0.980 | PREC=0.975 | REC=0.975 | Time=3.5s
19:43:08 │ INFO │ Adding probability calibration to RidgeClassifier
19:43:23 │ INFO │       ✅   Ridge_TEXT: F1=0.975 | ACC=0.980 | PREC=0.975 | REC=0.975 | Time=22.2s
19:43:24 │ INFO │ Adding probability calibration to PassiveAggressiveClassifier
19:43:30 │ INFO │       ✅      PA_TEXT: F1=0.975 | ACC=0.980 | PREC=0.975 | REC=0.975 | Time=6.7s
19:43:31 │ INFO │       ✅     SGD_TEXT: F1=0.962 | ACC=0.970 | PREC=0.974 | REC=0.950 | Time=1.2s
19:43:31 │ INFO │    🎯 VEGAN COMPLETE:
19:43:31 │ INFO │    ├─ Best Model: NB_TEXT (F1=0.975)
19:43:31 │ INFO │    ├─ Final Metrics: ACC=0.980 | PREC=0.975 | REC=0.975
19:43:31 │ INFO │    └─ Task Time: 34.0s
19:43:31 │ INFO │ 
🏁 MODE A PIPELINE COMPLETE:
19:43:31 │ INFO │    ├─ Total Time: 66.1s
19:43:31 │ INFO │    ├─ Tasks Completed: 2
19:43:31 │ INFO │    └─ Domain: text
19:43:31 │ INFO │ 
📊 FINAL RESULTS SUMMARY:
19:43:31 │ INFO │    1.  KETO |         NB_TEXT | F1=0.963 | ACC=0.970 | Time=0.1s
19:43:31 │ INFO │    2. VEGAN |         NB_TEXT | F1=0.975 | ACC=0.980 | Time=0.1s
19:43:31 │ INFO │ 
╭─ MODE A (silver → gold) ───────────────────────────────────
19:43:31 │ INFO │ │ model task     ACC    PREC     REC      F1     ROC      PR │
19:43:31 │ INFO │ ├────────────────────────────────────────────────────────────┤
19:43:31 │ INFO │ │ NB_TEXT keto     0.97    0.95    0.97    0.96    0.97    0.94 │
19:43:31 │ INFO │ │ NB_TEXT vegan    0.98    0.97    0.97    0.97    0.97    0.93 │
19:43:31 │ INFO │ ╰────────────────────────────────────────────────────────────╯
19:43:31 │ INFO │       ✅ Text models: 2 results
19:43:31 │ INFO │ System/Container total memory: 31.3 GB
19:43:31 │ INFO │ Safe memory limit (100%): 31.3 GB
19:43:31 │ INFO │    🧹 Text Models: Memory optimization
19:43:31 │ INFO │       ├─ Container/System memory: 31.3 GB total
19:43:31 │ INFO │       ├─ Currently used: 36.5% (11067 MB)
19:43:32 │ INFO │       ├─ Freed: 0.0 MB RAM
19:43:32 │ INFO │       ├─ Objects collected: 96
19:43:32 │ INFO │       ✅ Memory usage normal: 36.5%
19:43:32 │ INFO │    🤝 Creating text+image ensemble...
19:43:32 │ INFO │       ├─ keto: Testing alpha values [0.25, 0.5, 0.75]
19:43:32 │ INFO │ ▶️  BEST-TWO (keto) — text=NB_TEXT (F1=0.963), image=LGBM_IMAGE
19:43:32 │ INFO │    ├─ Text predictions: 100 samples
19:43:32 │ INFO │    ├─ Image predictions: 66 samples
19:43:32 │ INFO │    └─ Blending with alpha=0.25
19:43:32 │ INFO │          ├─ alpha=0.25: F1=0.963
19:43:32 │ INFO │ ▶️  BEST-TWO (keto) — text=NB_TEXT (F1=0.963), image=LGBM_IMAGE
19:43:32 │ INFO │    ├─ Text predictions: 100 samples
19:43:32 │ INFO │    ├─ Image predictions: 66 samples
19:43:32 │ INFO │    └─ Blending with alpha=0.5
19:43:32 │ INFO │          ├─ alpha=0.5: F1=0.921
19:43:32 │ INFO │ ▶️  BEST-TWO (keto) — text=NB_TEXT (F1=0.963), image=LGBM_IMAGE
19:43:32 │ INFO │    ├─ Text predictions: 100 samples
19:43:32 │ INFO │    ├─ Image predictions: 66 samples
19:43:32 │ INFO │    └─ Blending with alpha=0.75
19:43:32 │ INFO │          ├─ alpha=0.75: F1=0.921
19:43:32 │ INFO │       ✅ keto best ensemble: alpha=0.25, F1=0.963
19:43:32 │ INFO │       ├─ vegan: Testing alpha values [0.25, 0.5, 0.75]
19:43:32 │ INFO │ ▶️  BEST-TWO (vegan) — text=NB_TEXT (F1=0.975), image=LGBM_IMAGE
19:43:32 │ INFO │    ├─ Text predictions: 100 samples
19:43:32 │ INFO │    ├─ Image predictions: 66 samples
19:43:32 │ INFO │    └─ Blending with alpha=0.25
19:43:32 │ INFO │          ├─ alpha=0.25: F1=0.975
19:43:32 │ INFO │ ▶️  BEST-TWO (vegan) — text=NB_TEXT (F1=0.975), image=LGBM_IMAGE
19:43:32 │ INFO │    ├─ Text predictions: 100 samples
19:43:32 │ INFO │    ├─ Image predictions: 66 samples
19:43:32 │ INFO │    └─ Blending with alpha=0.5
19:43:32 │ INFO │          ├─ alpha=0.5: F1=0.961
19:43:32 │ INFO │ ▶️  BEST-TWO (vegan) — text=NB_TEXT (F1=0.975), image=LGBM_IMAGE
19:43:32 │ INFO │    ├─ Text predictions: 100 samples
19:43:32 │ INFO │    ├─ Image predictions: 66 samples
19:43:32 │ INFO │    └─ Blending with alpha=0.75
19:43:32 │ INFO │          ├─ alpha=0.75: F1=0.961
19:43:32 │ INFO │       ✅ vegan best ensemble: alpha=0.25, F1=0.975
19:43:32 │ INFO │ 
╭─ Text+Image Ensembles ─────────────────────────────────────
19:43:32 │ INFO │ │ model task     ACC    PREC     REC      F1     ROC      PR │
19:43:32 │ INFO │ ├────────────────────────────────────────────────────────────┤
19:43:32 │ INFO │ │ BestTwo_alpha0.25 keto     0.97    0.95    0.97    0.96    0.99    0.98 │
19:43:32 │ INFO │ │ BestTwo_alpha0.25 vegan    0.98    0.97    0.97    0.97    0.99    0.98 │
19:43:32 │ INFO │ ╰────────────────────────────────────────────────────────────╯
19:43:32 │ INFO │       ✅ Created 2 ensemble configurations
19:43:32 │ INFO │    🔄 Training final combined models...
19:43:36 │ INFO │       ├─ Combined silver features: (72422, 52048)
19:43:36 │ INFO │       ├─ Combined gold features: (66, 52048)
19:43:36 │ INFO │       ├─ Silver samples: 72,422
19:43:36 │ INFO │       └─ Gold samples: 66
19:43:36 │ INFO │ 🚀 Starting MODE A Training Pipeline
19:43:36 │ INFO │    Domain: both
19:43:36 │ INFO │    SMOTE enabled: True
19:43:36 │ INFO │    Silver set size: 72,422
19:43:36 │ INFO │    Gold set size: 66
19:43:36 │ INFO │    Feature dimensions: (72422, 52048)
19:43:36 │ INFO │ 
📊 Class Distribution Analysis:
19:43:36 │ INFO │     Keto - Silver: 11,786/72,422 (16.3%) | Gold: 34/66 (51.5%)
19:43:36 │ INFO │    Vegan - Silver: 5,224.0/72,422 (7.2%) | Gold: 35/66 (53.0%)
19:43:36 │ INFO │ 
🎯 Processing KETO classification:
19:43:36 │ INFO │    Training labels - Positive: 11,786 (16.3%)
19:43:36 │ INFO │    Test labels - Positive: 34 (51.5%)
19:43:36 │ INFO │    Minority class ratio: 16.3%
19:43:37 │ INFO │    🔄 Applying SMOTE (minority < 30%)...
19:43:37 │ INFO │    ✅ SMOTE completed in 0.4s
19:43:37 │ INFO │    ├─ Size: 72,422 → 121,272 (1.7x)
19:43:37 │ INFO │    └─ Minority ratio: 16.3% → 50.0%
19:43:37 │ INFO │    🤖 Training 8 models: ['Rule', 'NB', 'Softmax', 'Ridge', 'PA', 'SGD', 'RF', 'LGBM']
19:43:37 │ ERROR │       ❌ Rule: Prediction failed - sparse array length is ambiguous; use ge...
19:43:37 │ INFO │       ✅      NB_BOTH: F1=0.957 | ACC=0.955 | PREC=0.943 | REC=0.971 | Time=0.3s
19:43:37 │ INFO │       🏆 New best model for keto: NB_BOTH (F1=0.957)
19:46:23 │ INFO │       ✅ Softmax_BOTH: F1=0.941 | ACC=0.939 | PREC=0.941 | REC=0.941 | Time=165.5s
19:52:24 │ INFO │ Adding probability calibration to RidgeClassifier

================================================================================
NEW RUN STARTED AT 2025-06-28 19:55:41
Process ID: 374
================================================================================
19:55:41 │ INFO │ Logging system initialized successfully
19:55:44 │ INFO │ USDA carb table loaded: 303 distinct food descriptions
19:55:44 │ INFO │ Carb map initialised (303 keys)
19:55:44 │ INFO │ ✅ All sanity checks passed

================================================================================
NEW RUN STARTED AT 2025-06-28 19:58:41
Process ID: 423
================================================================================
19:58:41 │ INFO │ Logging system initialized successfully
19:58:43 │ INFO │ USDA carb table loaded: 303 distinct food descriptions
19:58:43 │ INFO │ Carb map initialised (303 keys)
19:58:43 │ INFO │ ✅ All sanity checks passed

================================================================================
NEW RUN STARTED AT 2025-06-28 19:59:20
Process ID: 472
================================================================================
19:59:20 │ INFO │ Logging system initialized successfully
19:59:22 │ INFO │ USDA carb table loaded: 303 distinct food descriptions
19:59:22 │ INFO │ Carb map initialised (303 keys)
19:59:22 │ INFO │ ✅ All sanity checks passed
